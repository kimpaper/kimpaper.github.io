---
layout: post
title: spring map to xml viewresolver
date: '2015-02-05T17:16:00.001-08:00'
author: 페이퍼
tags:
- spring
- xmlview
modified_time: '2015-10-06T02:38:44.117-07:00'
blogger_id: tag:blogger.com,1999:blog-335715462918866001.post-7168819677260787069
blogger_orig_url: http://kimpaper.blogspot.com/2015/02/spring-map-to-xml-viewresolver.html
---

<br />항상 json으로만 뱉다가 xml로 뱉어야 하는 상황이 발생해서 만든 spring view 클래스<br />결과가 map에 경우에만 해당됨<br /><br />아래 설정하고...<br /><pre><code><br />    <beans:bean id="xmlView2" class="org.springframework.web.servlet.view.XmlViewResolver"><br />        <beans:property name="order" value="1"/><br />        <beans:property name="location" value="classpath:xml-views.xml"/><br />    </beans:bean><br /></code></pre><br />xml-views.xml 내용.<br /><pre><code><br /><?xml version="1.0" encoding="UTF-8"?><br /><!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN"<br />        "http://www.springframework.org/dtd/spring-beans.dtd"><br /><beans><br /><br />    <bean name="xmlView"  class="com.xxxxx.view.AjaxResponseXMLView"><br />        <property name="contentType"><br />            <value>text/xml;charset=utf-8</value><br />        </property><br />    </bean><br /><br /></beans><br /></code></pre><br />아래 클래스를 이용함<br /><pre><code><br />public class AjaxResponseXMLView extends AbstractView {<br /><br />    @Override<br />    protected void renderMergedOutputModel(Map map, HttpServletRequest request,<br />                                           HttpServletResponse response) throws Exception {<br />        String xmlHeader = "\r\n";<br /><br />        StringBuffer xmlSb = new StringBuffer();<br />        xmlSb.append(xmlHeader);<br />        xmlSb.append("");<br />        writeFromMap(xmlSb, map);<br />        xmlSb.append("");<br /><br />        response.setContentType("application/xml");<br />        response.setCharacterEncoding("utf-8");<br />        response.setHeader("Cache-Control", "no-cache");<br />        response.setContentLength(xmlSb.toString().getBytes("utf-8").length);<br />        response.getWriter().print(xmlSb.toString());<br />    }<br /><br />    private void writeFromMap(StringBuffer sb, Map map) {<br /><br />        for(Object str : map.keySet()) {<br />            Object v = map.get(str);<br />            sb.append("<" + str + ">");<br />            if(v instanceof Map) {<br />                writeFromMap(sb, (Map) v);<br />            }<br />            else if(v instanceof List) {<br />                writeFromList(sb, (List) v);<br />            }<br />            else {<br />                writeFromData(sb, v);<br />            }<br />            sb.append("</" + str + ">");<br />        }<br />    }<br /><br />    private void writeFromList(StringBuffer sb, List list) {<br /><br />        for(Object v : list) {<br />            sb.append("");<br />            if(v instanceof Map) {<br />                writeFromMap(sb, (Map)v);<br />            }<br />            else if(v instanceof List) {<br />                writeFromList(sb, (List) v);<br />            }<br />            else {<br />                writeFromData(sb, v);<br />            }<br />            sb.append("");<br />        }<br />    }<br /><br />    private void writeFromData(StringBuffer sb, Object data) {<br />        sb.append(escapeXml(data+""));<br />    }<br /><br />    private String escapeXml(String src) {<br />//        "   "<br />//        <   <<br />//        >   ><br />//        &   &<br />        src = src.replace("\"", """);<br />        src = src.replace("<", "<");<br />        src = src.replace(">", ">");<br />        src = src.replace("&", "&");<br /><br />        return src;<br />    }<br />}<br /><br /></code></pre>