---
layout: post
title: 'spring jpa 조회 연습 '
date: '2015-10-07T18:04:00.001-07:00'
author: 페이퍼
tags:
- spring
modified_time: '2015-10-12T02:44:41.766-07:00'
blogger_id: tag:blogger.com,1999:blog-335715462918866001.post-4483482309913710725
blogger_orig_url: http://kimpaper.blogspot.com/2015/10/spring-jpa.html
---

entity 작업에 조회까지.. 테스트 해봤습니다.<br /><br />- 테이블의 관계가 아래와 같을때 상황<br />tb_member -&lt; tb_member_inter >- tb_inter<br />-&lt; tb_image<br /><br />조회 조건<br />1. Member를 가져오면.. member의 이미지들과... inter의 목록을 함께 가져오도록<br />2. inter의 상세 정보는 tb_inter에 있음 (가져올때 조인해서..)<br /><br /><br />아래 class들 간략 설명 <br />. MemberInter의 PK가 두개이므로. 위와 같이 클래스를 하나 만들어서 @IdClass를 지정해야 함<br />. @Expose 는 Gson관련하여 화면에 뿌릴 필드를 정하는 옵션입니다. jpa와는 무관합니다.<br />. MemberInter.class에서 많이 헷갈렸습니다. (@ManyToOne)<br />-- @JoinColumn을 추가로.. 써야 합니다.<br />-- optional을 true로 하면 join시 outer join을 합니다. (false는 inner join)<br /><br /><br />FetchType.EAGER -> 즉시 조회해서 데이타 채움 <br />FetchType.LAZY -> 필요시 DB조회 <br /><br /><br />##나중에 추가됨<br /><b>- 필드명은 카멜케이스CamelCase를 꼭 써야 한다. 안그럼 나중에 method named query 시에 곤란해진다...</b><br /><br /><br /><br />Member.java<br /><pre><code class="noxml"><br />@Entity @Table(name = "tb_member")<br />public class Member {<br />    @Id @GeneratedValue(strategy = GenerationType.AUTO)<br />    private Integer member_seq;<br /><br />    @Expose<br />    @OneToMany(<br />            targetEntity = Image.class<br />            , cascade = CascadeType.ALL<br />            , fetch = FetchType.EAGER<br />            , mappedBy = "member_seq")<br />    private List&lt;image> imageList;<br /><br />    @Expose<br />    @OneToMany(<br />            targetEntity = MemberInter.class<br />            , cascade = CascadeType.ALL<br />            , fetch = FetchType.EAGER<br />            , mappedBy = "member_seq")<br />    private List&lt;memberinter> memberInterList;<br />}<br /></code></pre><br /><br />MemberRepository.java<br /><pre><code class="noxml"><br />public interface MemberRepository extends JpaRepository&lt;Member, Integer> {<br /><br />}<br /></code></pre><br /><br />Image.java<br /><pre><code><br />@Entity<br />@Table(name = "tb_image")<br />public class Image {<br />    @Id<br />    @GeneratedValue<br />    private Integer image_seq;<br />    @Column<br />    private Integer member_seq;<br />    @Column @Expose<br />    private String file_name;<br />}<br /></code></pre><br /><br />Inter.java<br /><pre><code><br />@Entity @Table(name="tb_inter") @Embeddable<br />public class Inter {<br />    @Id @GeneratedValue(strategy = GenerationType.AUTO)<br />    private Integer inter_seq;<br />    @Column @Expose<br />    private String inter_name_ko;<br />}<br /></code></pre><br /><br />MemberInter.java<br /><pre><code><br />@Entity @Table(name="tb_member_inter") @IdClass(MemberInterPk.class)<br />public class MemberInter {<br />    @Id @Column<br />    private Integer member_seq;<br /><br />    @Id @Column(insertable = false, updatable = false)<br />    private Integer inter_seq;<br /><br />    @ManyToOne(<br />            targetEntity = Inter.class<br />            ,cascade = CascadeType.ALL<br />            ,fetch = FetchType.EAGER<br />            ,optional = false<br />    )<br />    @JoinColumn(name = "inter_seq")<br />    @Expose<br />    private Inter inter;<br />}<br /></code></pre><br /><br />MemberInterPk.java<br /><pre><code><br />public class MemberInterPk implements Serializable {<br />    private Integer member_seq;<br />    private Integer inter_seq;<br />}<br /></code></pre><br /><br />test 코드...<br />TestServiceTest.java<br /><pre><code class="noxml"><br />@RunWith(SpringJUnit4ClassRunner.class)<br />@ContextConfiguration({<br />        "classpath:servlet-context.xml",<br />        "classpath:config/context-datasource.xml"<br />})<br />public class TestServiceTest {<br />    private static final Logger logger = LoggerFactory.getLogger(TestServiceTest.class);<br /><br />    @Autowired<br />    private Gson gson;<br /><br />    @Autowired<br />    private MemberRepository memberRepository;<br /><br />    @Test<br />    public void testGetMemberList() throws Exception {<br />        logger.info("------------ jpa test starting.... ------------------------");<br /><br />        List&lt;member> list = memberRepository.findAll();<br />        logger.info("memberList={}", gson.toJson(list));<br /><br />        logger.info("------------ jpa test ended....    ------------------------");<br />    }<br />}<br /></code></pre><br /><br />